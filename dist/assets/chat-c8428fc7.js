import{r as d,o as Pe,bi as Me,bp as ee,j as e,B as f,T,bO as q,P as p,a6 as re,O as ae,a5 as ue,d as C,z as pe,bm as Le,aW as De,f as fe,bP as xe,A as W,g as G,c as A,H as We,bD as Y,Y as R,Z as N,bM as _,i as V,p as D,D as U,s as Fe,bQ as Oe,J as Ge,bR as Ue,u as me,a as qe,a9 as Ne,aa as ce,bN as ne,L as Be,_ as ie,aR as He,aS as Ke,M as z,bC as Q,aN as Xe}from"./index-345a54fd.js";import{S as $e}from"./seo-ea61f518.js";import{u as ze}from"./use-page-view-43790c32.js";import{u as ye}from"./use-search-params-d91f4e53.js";import{c as de}from"./create-resource-id-72a4f5fb.js";import{d as te}from"./deep-copy-ee95be26.js";import{s as S}from"./index-ecc76830.js";import{s as Z}from"./index-71286f46.js";import{s as K}from"./index-96e7fc06.js";import{L as ge}from"./ListItemAvatar-3478d645.js";import{A as Qe}from"./Attachment01-727b2701.js";import{C as ve}from"./Camera01-3f407031.js";import{S as Ye}from"./Send01-c3b36b28.js";import{P as Ze}from"./Plus-2c210ce3.js";import{A as je}from"./AvatarGroup-b217efdf.js";import{f as _e}from"./index-cfaae174.js";import{f as be}from"./index-edd143a2.js";import{C as Ve}from"./Card-15cadf45.js";import{C as Je}from"./CardMedia-87337673.js";import{A as et}from"./Archive-f7314ead.js";import{D as tt}from"./DotsHorizontal-f694e7a0.js";import{T as st}from"./Trash02-192f00ab.js";import"./index-674a8e98.js";function le(s){return s.substring(2).toLowerCase()}function rt(s,t){return t.documentElement.clientWidth<s.clientX||t.documentElement.clientHeight<s.clientY}function Ce(s){const{children:t,disableReactTree:a=!1,mouseEvent:n="onClick",onClickAway:c,touchEvent:r="onTouchEnd"}=s,i=d.useRef(!1),o=d.useRef(null),l=d.useRef(!1),h=d.useRef(!1);d.useEffect(()=>(setTimeout(()=>{l.current=!0},0),()=>{l.current=!1}),[]);const g=Pe(t.ref,o),x=Me(y=>{const m=h.current;h.current=!1;const k=ee(o.current);if(!l.current||!o.current||"clientX"in y&&rt(y,k))return;if(i.current){i.current=!1;return}let P;y.composedPath?P=y.composedPath().indexOf(o.current)>-1:P=!k.documentElement.contains(y.target)||o.current.contains(y.target),!P&&(a||!m)&&c(y)}),u=y=>m=>{h.current=!0;const k=t.props[y];k&&k(m)},w={ref:g};return r!==!1&&(w[r]=u(r)),d.useEffect(()=>{if(r!==!1){const y=le(r),m=ee(o.current),k=()=>{i.current=!0};return m.addEventListener(y,x),m.addEventListener("touchmove",k),()=>{m.removeEventListener(y,x),m.removeEventListener("touchmove",k)}}},[x,r]),n!==!1&&(w[n]=u(n)),d.useEffect(()=>{if(n!==!1){const y=le(n),m=ee(o.current);return m.addEventListener(y,x),()=>{m.removeEventListener(y,x)}}},[x,n]),e.jsx(d.Fragment,{children:d.cloneElement(t,w)})}const at=()=>e.jsxs(f,{sx:{alignItems:"center",display:"flex",flexGrow:1,flexDirection:"column",justifyContent:"center",overflow:"hidden"},children:[e.jsx(f,{component:"img",src:"/assets/errors/error-404.png",sx:{height:"auto",maxWidth:120}}),e.jsx(T,{color:"text.secondary",sx:{mt:2},variant:"subtitle1",children:"Start meaningful conversations!"})]}),v=new Date,O=[{id:"5e8891ab188cd2855e6029b7",avatar:"/assets/avatars/avatar-alcides-antonio.png",isActive:!0,lastActivity:v.getTime(),name:"Alcides Antonio"},{id:"5e887a62195cc5aef7e8ca5d",avatar:"/assets/avatars/avatar-marcus-finn.png",isActive:!1,lastActivity:S(v,2).getTime(),name:"Marcus Finn"},{id:"5e887ac47eed253091be10cb",avatar:"/assets/avatars/avatar-carson-darrin.png",isActive:!1,lastActivity:Z(v,15).getTime(),name:"Carson Darrin"},{id:"5e887b209c28ac3dd97f6db5",avatar:"/assets/avatars/avatar-fran-perez.png",isActive:!0,lastActivity:v.getTime(),name:"Fran Perez"},{id:"5e887b7602bdbc4dbb234b27",avatar:"/assets/avatars/avatar-jie-yan-song.png",isActive:!0,lastActivity:v.getTime(),name:"Jie Yan Song"},{id:"5e86805e2bafd54f66cc95c3",avatar:"/assets/avatars/avatar-miron-vitold.png",isActive:!1,lastActivity:S(v,1).getTime(),name:"Miron Vitold"},{id:"5e887a1fbefd7938eea9c981",avatar:"/assets/avatars/avatar-penjani-inyene.png",isActive:!1,lastActivity:S(v,6).getTime(),name:"Penjani Inyene"},{id:"5e887d0b3d090c1b8f162003",avatar:"/assets/avatars/avatar-omar-darboe.png",isActive:!0,lastActivity:v.getTime(),name:"Omar Darobe"},{id:"5e88792be2d4cfb4bf0971d9",avatar:"/assets/avatars/avatar-siegbert-gottfried.png",isActive:!0,lastActivity:v.getTime(),name:"Siegbert Gottfried"},{id:"5e8877da9a65442b11551975",avatar:"/assets/avatars/avatar-iulia-albu.png",isActive:!0,lastActivity:v.getTime(),name:"Iulia Albu"},{id:"5e8680e60cba5019c5ca6fda",avatar:"/assets/avatars/avatar-nasimiyu-danai.png",isActive:!0,lastActivity:v.getTime(),name:"Nasimiyu Danai"}],X=[{id:"5e867eb9de721aecaccf4f7b",messages:[{id:"5e867f0a5bc0ff2bfa07bfa6",attachments:[],body:"Hey, nice projects! I really liked the one in react. What's your quote on kinda similar project?",contentType:"text",createdAt:K(S(v,10),4).getTime(),authorId:"5e86805e2bafd54f66cc95c3"},{id:"5e867f167d5f78109ae9f2a4",attachments:[],body:"I would need to know more details, but my hourly rate stats at $35/hour. Thanks!",contentType:"text",createdAt:K(S(v,2),4).getTime(),authorId:"5e86809283e28b96d2d38537"},{id:"5e867f1c9ca72084693528f4",attachments:[],body:"Well it's a really easy one, I'm sure we can make it half of the price.",contentType:"text",createdAt:S(v,5).getTime(),authorId:"5e86805e2bafd54f66cc95c3"},{id:"5e867f22fd2e27a09849b4db",attachments:[],body:"Then why don't you make it if it's that easy? Sorry I'm not interetes, have fantastic day Adam!",contentType:"text",createdAt:S(v,3).getTime(),authorId:"5e86809283e28b96d2d38537"},{id:"5e867f28a34d45ac6eb5c41f",attachments:[],body:"Last offer, $25 per hour",contentType:"text",createdAt:S(v,2).getTime(),authorId:"5e86805e2bafd54f66cc95c3"},{id:"5e867f2dba984a3f78b33526",attachments:[],body:"/assets/covers/minimal-1-4x3-small.png",contentType:"image",createdAt:S(v,1).getTime(),authorId:"5e86805e2bafd54f66cc95c3"}],participantIds:["5e86809283e28b96d2d38537","5e86805e2bafd54f66cc95c3"],type:"ONE_TO_ONE",unreadCount:2},{id:"5e867fa7082c3c5921403a26",messages:[{id:"5e867fc180837d901bd9bca1",attachments:[],body:"Hey, would you like to collaborate?",contentType:"text",createdAt:K(Z(v,6),3).getTime(),authorId:"5e8680e60cba5019c5ca6fda"},{id:"5e8d6fb695df7971237fc173",attachments:[],body:"Hi, Merrile!",contentType:"text",createdAt:K(Z(v,5),3).getTime(),authorId:"5e86809283e28b96d2d38537"},{id:"58825a290eb4d4271a54f188",attachments:[],body:"Hello everyone ðŸ˜€",contentType:"text",createdAt:K(Z(v,2),1).getTime(),authorId:"5e8891ab188cd2855e6029b7"}],participantIds:["5e86809283e28b96d2d38537","5e8680e60cba5019c5ca6fda","5e8891ab188cd2855e6029b7"],type:"GROUP",unreadCount:0}],L={id:"5e86809283e28b96d2d38537",avatar:"/assets/avatars/avatar-anika-visser.png",name:"Anika Visser"},se=s=>X.find(t=>t.id===s),he=s=>X.find(t=>{if(t.participantIds.length!==s.length)return!1;const a=new Set;return t.participantIds.forEach(n=>{s.includes(n)&&a.add(n)}),a.size===s.length});class nt{getContacts(t={}){const{query:a}=t;return new Promise((n,c)=>{try{let r=O;if(a){const i=a.toLowerCase().trim();r=r.filter(o=>o.name.toLowerCase().includes(i))}n(te(r))}catch(r){console.error("[Chat Api]: ",r),c(new Error("Internal server error"))}})}getThreads(t={}){const a=X.map(n=>{const c=[L];return O.forEach(r=>{n.participantIds.includes(r.id)&&c.push({id:r.id,avatar:r.avatar,lastActivity:r.lastActivity,name:r.name})}),{...n,participants:c}});return Promise.resolve(te(a))}getThread(t){const{threadKey:a}=t;return new Promise((n,c)=>{if(!a){c(new Error("Thread key is required"));return}try{let r;const i=O.find(h=>h.id===a);if(i&&(r=he([L.id,i.id])),r||(r=se(a)),!r)return n(null);const o=[L];O.forEach(h=>{r.participantIds.includes(h.id)&&o.push({id:h.id,avatar:h.avatar,lastActivity:h.lastActivity,name:h.name})});const l={...r,participants:o};n(te(l))}catch(r){console.error("[Chat Api]: ",r),c(new Error("Internal server error"))}})}markThreadAsSeen(t){const{threadId:a}=t;return new Promise((n,c)=>{try{const r=X.find(i=>i.id===a);r&&(r.unreadCount=0),n(!0)}catch(r){console.error("[Chat Api]: ",r),c(new Error("Internal server error"))}})}getParticipants(t){const{threadKey:a}=t;return new Promise((n,c)=>{try{const r=[L],i=se(a);if(i)O.forEach(o=>{i.participantIds.includes(o.id)&&r.push({id:o.id,avatar:o.avatar,lastActivity:o.lastActivity,name:o.name})});else{const o=O.find(l=>l.id===a);if(!o){c(new Error("Unable to find the contact"));return}r.push({id:o.id,avatar:o.avatar,lastActivity:o.lastActivity,name:o.name})}return n(r)}catch(r){console.error("[Chat Api]: ",r),c(new Error("Internal server error"))}})}addMessage(t){const{threadId:a,recipientIds:n,body:c}=t;return new Promise((r,i)=>{try{if(!(a||n)){i(new Error("Thread ID or recipient IDs has to be provided"));return}let o;if(a){if(o=se(a),!o){i(new Error("Invalid thread id"));return}}else{const h=[L.id,...n||[]];o=he(h)}if(!o){const h=[L.id,...n||[]];o={id:de(),messages:[],participantIds:h,type:h.length===2?"ONE_TO_ONE":"GROUP",unreadCount:0},X.push(o)}const l={id:de(),attachments:[],body:c,contentType:"text",createdAt:new Date().getTime(),authorId:L.id};o.messages.push(l),r({threadId:o.id,message:l})}catch(o){console.error("[Chat Api]: ",o),i(new Error("Internal server error"))}})}}const E=new nt,it=()=>async s=>{const t=await E.getContacts({});s(q.actions.getContacts(t))},ot=()=>async s=>{const t=await E.getThreads();s(q.actions.getThreads(t))},ct=s=>async t=>{const a=await E.getThread(s);return t(q.actions.getThread(a)),a==null?void 0:a.id},dt=s=>async t=>{await E.markThreadAsSeen(s),t(q.actions.markThreadAsSeen(s.threadId))},lt=s=>t=>{t(q.actions.setCurrentThread(s.threadId))},ht=s=>async t=>{const a=await E.addMessage(s);return t(q.actions.addMessage(a)),a.threadId},I={addMessage:ht,getContacts:it,getThread:ct,getThreads:ot,markThreadAsSeen:dt,setCurrentThread:lt},Te=s=>{const{onRecipientAdd:t,onRecipientRemove:a,recipients:n=[],...c}=s,r=d.useRef(null),[i,o]=d.useState(!1),[l,h]=d.useState(""),[g,x]=d.useState([]),u=!!(i&&l),w=g.length>0,y=d.useCallback(async b=>{const B=b.target.value;if(h(B),!B){x([]);return}try{const H=await E.getContacts({query:B}),J=n.map(j=>j.id),$=H.filter(j=>!J.includes(j.id));x($)}catch(H){console.error(H)}},[n]),m=d.useCallback(()=>{u&&o(!1)},[u]),k=d.useCallback(()=>{o(!0)},[]),P=d.useCallback(b=>{h(""),t==null||t(b)},[t]);return e.jsx(e.Fragment,{children:e.jsx(f,{...c,children:e.jsx(re,{children:e.jsxs(f,{sx:{alignItems:"center",display:"flex",p:2},children:[e.jsx(Ce,{onClickAway:m,children:e.jsxs(f,{sx:{mr:1},children:[e.jsx(ae,{fullWidth:!0,onChange:y,onFocus:k,placeholder:"Search contacts",ref:r,startAdornment:e.jsx(ue,{position:"start",children:e.jsx(C,{children:e.jsx(pe,{})})}),sx:{"&.MuiInputBase-root":{height:40,minWidth:260}},value:l}),u&&e.jsx(Le,{anchorEl:r.current,open:i,placement:"bottom-start",children:e.jsx(De,{elevation:16,sx:{borderColor:"divider",borderStyle:"solid",borderWidth:1,maxWidth:"100%",mt:1,width:320},children:w?e.jsxs(e.Fragment,{children:[e.jsx(f,{sx:{px:2,pt:2},children:e.jsx(T,{color:"text.secondary",variant:"subtitle2",children:"Contacts"})}),e.jsx(fe,{children:g.map(b=>e.jsxs(xe,{onClick:()=>P(b),children:[e.jsx(ge,{children:e.jsx(W,{src:b.avatar})}),e.jsx(G,{primary:b.name,primaryTypographyProps:{noWrap:!0,variant:"subtitle2"}})]},b.id))})]}):e.jsxs(f,{sx:{p:2,textAlign:"center"},children:[e.jsx(T,{gutterBottom:!0,variant:"h6",children:"Nothing Found"}),e.jsxs(T,{color:"text.secondary",variant:"body2",children:[`We couldn't find any matches for "`,l,'". Try checking for typos or using complete words.']})]})})})]})}),e.jsx(T,{color:"text.secondary",sx:{mr:2},variant:"body2",children:"To:"}),e.jsx(A,{alignItems:"center",direction:"row",spacing:2,children:n.map(b=>e.jsx(We,{avatar:e.jsx(W,{src:b.avatar}),label:b.name,onDelete:()=>a==null?void 0:a(b.id)},b.id))})]})})})})};Te.propTypes={onRecipientAdd:p.func,onRecipientRemove:p.func,recipients:p.array};const oe=s=>{const{disabled:t=!1,onSend:a,...n}=s,c=N(),r=d.useRef(null),[i,o]=d.useState(""),l=d.useCallback(()=>{var u;(u=r.current)==null||u.click()},[]),h=d.useCallback(u=>{o(u.target.value)},[]),g=d.useCallback(()=>{i&&(a==null||a(i),o(""))},[i,a]),x=d.useCallback(u=>{u.code==="Enter"&&g()},[g]);return e.jsxs(A,{alignItems:"center",direction:"row",spacing:2,sx:{px:3,py:1},...n,children:[e.jsx(W,{sx:{display:{xs:"none",sm:"inline"}},src:c.avatar}),e.jsx(ae,{disabled:t,fullWidth:!0,onChange:h,onKeyUp:x,placeholder:"Leave a message",size:"small",value:i}),e.jsxs(f,{sx:{alignItems:"center",display:"flex",m:-2,ml:2},children:[e.jsx(Y,{title:"Send",children:e.jsx(f,{sx:{m:1},children:e.jsx(R,{color:"primary",disabled:!i||t,sx:{backgroundColor:"primary.main",color:"primary.contrastText","&:hover":{backgroundColor:"primary.dark"}},onClick:g,children:e.jsx(C,{children:e.jsx(Ye,{})})})})}),e.jsx(Y,{title:"Attach photo",children:e.jsx(f,{sx:{display:{xs:"none",sm:"inline-flex"},m:1},children:e.jsx(R,{disabled:t,edge:"end",onClick:l,children:e.jsx(C,{children:e.jsx(ve,{})})})})}),e.jsx(Y,{title:"Attach file",children:e.jsx(f,{sx:{display:{xs:"none",sm:"inline-flex"},m:1},children:e.jsx(R,{disabled:t,edge:"end",onClick:l,children:e.jsx(C,{children:e.jsx(Qe,{})})})})})]}),e.jsx("input",{hidden:!0,ref:r,type:"file"})]})};oe.propTypes={disabled:p.bool,onSend:p.func};const ut=()=>{const[s,t]=d.useState([]),a=d.useCallback(c=>{t(r=>r.find(o=>o.id===c.id)?r:[...r,c])},[]),n=d.useCallback(c=>{t(r=>r.filter(i=>i.id!==c))},[]);return{handleRecipientAdd:a,handleRecipientRemove:n,recipients:s}},pt=s=>{const t=_(),a=V(),{handleRecipientAdd:n,handleRecipientRemove:c,recipients:r}=ut(),i=d.useCallback(async l=>{const h=r.map(x=>x.id);let g;try{g=await t(I.addMessage({recipientIds:h,body:l}))}catch(x){console.error(x);return}a.push(D.dashboard.chat+`?threadKey=${g}`)},[t,a,r]),o=r.length>0;return e.jsxs(f,{sx:{display:"flex",flexDirection:"column",flexGrow:1},...s,children:[e.jsx(Te,{onRecipientAdd:n,onRecipientRemove:c,recipients:r}),e.jsx(U,{}),e.jsx(f,{sx:{flexGrow:1}}),e.jsx(U,{}),e.jsx(oe,{disabled:!o,onSend:i})]})},ft=Fe("div",{shouldForwardProp:s=>s!=="open"})(({theme:s,open:t})=>({display:"flex",flexDirection:"column",flexGrow:1,overflow:"hidden",[s.breakpoints.up("md")]:{marginLeft:-380},transition:s.transitions.create("margin",{easing:s.transitions.easing.sharp,duration:s.transitions.duration.leavingScreen}),...t&&{[s.breakpoints.up("md")]:{marginLeft:0},transition:s.transitions.create("margin",{easing:s.transitions.easing.easeOut,duration:s.transitions.duration.enteringScreen})}})),we=d.forwardRef(function(t,a){const{isFocused:n,onChange:c,onClickAway:r=()=>{},onFocus:i,onSelect:o,query:l="",results:h=[],...g}=t,x=d.useCallback(m=>{o==null||o(m)},[o]),u=n&&!l,w=n&&l,y=h.length>0;return e.jsx(Ce,{onClickAway:r,children:e.jsxs(f,{ref:a,sx:{p:2},...g,children:[e.jsx(ae,{fullWidth:!0,onChange:c,onFocus:i,placeholder:"Search contacts",startAdornment:e.jsx(ue,{position:"start",children:e.jsx(C,{children:e.jsx(pe,{})})}),value:l}),u&&e.jsx(f,{sx:{py:2},children:e.jsx(Oe,{message:"Enter a contact name"})}),w&&e.jsx(e.Fragment,{children:y?e.jsxs(f,{sx:{py:2},children:[e.jsx(T,{color:"text.secondary",variant:"subtitle2",children:"Contacts"}),e.jsx(fe,{children:h.map(m=>e.jsxs(xe,{onClick:()=>x(m),children:[e.jsx(ge,{children:e.jsx(W,{src:m.avatar,sx:{height:32,width:32}})}),e.jsx(G,{primary:m.name,primaryTypographyProps:{noWrap:!0,variant:"subtitle2"}})]},m.id))})]}):e.jsx(f,{sx:{py:2},children:e.jsxs(T,{color:"text.secondary",variant:"body2",children:[`We couldn't find any matches for "`,l,'". Try checking for typos or using complete words.']})})})]})})});we.propTypes={isFocused:p.bool,onChange:p.func,onClickAway:p.func,onFocus:p.func,onSelect:p.func,query:p.string,results:p.array};const xt={lessThanXSeconds:"{{count}}s",xSeconds:"{{count}}s",halfAMinute:"30s",lessThanXMinutes:"{{count}}m",xMinutes:"{{count}}m",aboutXHours:"{{count}}h",xHours:"{{count}}h",xDays:"{{count}}d",aboutXWeeks:"{{count}}w",xWeeks:"{{count}}w",aboutXMonths:"{{count}}m",xMonths:"{{count}}m",aboutXYears:"{{count}}y",xYears:"{{count}}y",overXYears:"{{count}}y",almostXYears:"{{count}}y"},mt={...Ge,formatDistance:(s,t,a)=>{a=a||{};const n=xt[s].replace("{{count}}",t);return a.addSuffix?a.comparison>0?"in "+n:n+" ago":n}},yt=s=>{var t;return(t=s.messages)==null?void 0:t[s.messages.length-1]},gt=(s,t)=>s.filter(a=>a.id!==t),vt=s=>s.map(t=>t.name).join(", "),jt=(s,t)=>{if(!t)return"";const a=t.authorId===s?"Me: ":"",n=t.contentType==="image"?"Sent a photo":t.body;return`${a}${n}`},bt=s=>s?_e(s.createdAt,new Date,{addSuffix:!1,locale:mt}):null,ke=s=>{const{active:t=!1,thread:a,onSelect:n,...c}=s,r=N(),i=gt(a.participants||[],r.id),o=yt(a),l=bt(o),h=vt(i),g=jt(r.id,o),x=i.length>1,u=!!(a.unreadCount&&a.unreadCount>0);return e.jsxs(A,{component:"li",direction:"row",onClick:n,spacing:2,sx:{borderRadius:2.5,cursor:"pointer",px:3,py:2,"&:hover":{backgroundColor:"action.hover"},...t&&{backgroundColor:"action.hover"}},...c,children:[e.jsx("div",{children:e.jsx(je,{max:2,sx:{[`& .${Ue.root}`]:x?{height:26,width:26,"&:nth-of-type(2)":{mt:"10px"}}:{height:36,width:36}},children:i.map(w=>e.jsx(W,{src:w.avatar||void 0},w.id))})}),e.jsxs(f,{sx:{flexGrow:1,overflow:"hidden"},children:[e.jsx(T,{noWrap:!0,variant:"subtitle2",children:h}),e.jsxs(A,{alignItems:"center",direction:"row",spacing:1,children:[u&&e.jsx(f,{sx:{backgroundColor:"primary.main",borderRadius:"50%",height:8,width:8}}),e.jsx(T,{color:"text.secondary",noWrap:!0,sx:{flexGrow:1},variant:"subtitle2",children:g})]})]}),l&&e.jsx(T,{color:"text.secondary",sx:{whiteSpace:"nowrap"},variant:"caption",children:l})]})};ke.propTypes={active:p.bool,onSelect:p.func,thread:p.object.isRequired};const Ct=(s,t)=>{let a;return s.type==="GROUP"?a=s.id:a=s.participantIds.find(n=>n!==t),a},Tt=()=>ne(s=>s.chat.threads),wt=()=>ne(s=>s.chat.currentThreadId),Ae=s=>{const{container:t,onClose:a,open:n,...c}=s,r=N(),i=V(),o=Tt(),l=wt(),[h,g]=d.useState(!1),[x,u]=d.useState(""),[w,y]=d.useState([]),m=me(j=>j.breakpoints.up("md")),k=d.useCallback(()=>{i.push(D.dashboard.chat+"?compose=true")},[i]),P=d.useCallback(async j=>{const{value:M}=j.target;if(u(M),!M){y([]);return}try{const F=await E.getContacts({query:M});y(F)}catch(F){console.error(F)}},[]),b=d.useCallback(()=>{h&&(g(!1),u(""))},[h]),B=d.useCallback(()=>{g(!0)},[]),H=d.useCallback(j=>{const M=j.id;g(!1),u(""),i.push(D.dashboard.chat+`?threadKey=${M}`)},[i]),J=d.useCallback(j=>{const M=o.byId[j],F=Ct(M,r.id);F?i.push(D.dashboard.chat+`?threadKey=${F}`):i.push(D.dashboard.chat)},[i,o,r]),$=e.jsxs("div",{children:[e.jsxs(A,{alignItems:"center",direction:"row",spacing:2,sx:{p:2},children:[e.jsx(T,{variant:"h5",sx:{flexGrow:1},children:"Chats"}),e.jsx(qe,{onClick:k,startIcon:e.jsx(C,{children:e.jsx(Ze,{})}),variant:"contained",children:"Group"}),!m&&e.jsx(R,{onClick:a,children:e.jsx(C,{children:e.jsx(Ne,{})})})]}),e.jsx(we,{isFocused:h,onChange:P,onClickAway:b,onFocus:B,onSelect:H,query:x,results:w}),e.jsx(f,{sx:{display:h?"none":"block"},children:e.jsx(re,{children:e.jsx(A,{component:"ul",spacing:.5,sx:{listStyle:"none",m:0,p:2},children:o.allIds.map(j=>e.jsx(ke,{active:l===j,onSelect:()=>J(j),thread:o.byId[j]},j))})})})]});return m?e.jsx(ce,{anchor:"left",open:n,PaperProps:{sx:{position:"relative",width:380}},SlideProps:{container:t},variant:"persistent",...c,children:$}):e.jsx(ce,{anchor:"left",hideBackdrop:!0,ModalProps:{container:t,sx:{pointerEvents:"none",position:"absolute"}},onClose:a,open:n,PaperProps:{sx:{maxWidth:"100%",width:380,pointerEvents:"auto",position:"absolute"}},SlideProps:{container:t},variant:"temporary",...c,children:$})};Ae.propTypes={container:p.any,onClose:p.func,open:p.bool};const Se=s=>{const{authorAvatar:t,authorName:a,body:n,contentType:c,createdAt:r,position:i,...o}=s,l=be(r);return e.jsx(f,{sx:{display:"flex",alignItems:i==="right"?"flex-end":"flex-start"},...o,children:e.jsxs(A,{alignItems:"flex-start",direction:i==="right"?"row-reverse":"row",spacing:2,sx:{maxWidth:500,ml:i==="right"?"auto":0,mr:i==="left"?"auto":0},children:[e.jsx(W,{src:t||void 0,sx:{height:32,width:32}}),e.jsxs(f,{sx:{flexGrow:1},children:[e.jsxs(Ve,{sx:{backgroundColor:i==="right"?"primary.main":"background.paper",color:i==="right"?"primary.contrastText":"text.primary",px:2,py:1},children:[e.jsx(f,{sx:{mb:1},children:e.jsx(Be,{color:"inherit",sx:{cursor:"pointer"},variant:"subtitle2",children:a})}),c==="image"&&e.jsx(Je,{onClick:()=>{},image:n,sx:{height:200,width:200}}),c==="text"&&e.jsx(T,{color:"inherit",variant:"body1",children:n})]}),e.jsx(f,{sx:{display:"flex",justifyContent:i==="right"?"flex-end":"flex-start",mt:1,px:2},children:e.jsxs(T,{color:"text.secondary",noWrap:!0,variant:"caption",children:[l," ago"]})})]})]})})};Se.propTypes={authorAvatar:p.string.isRequired,authorName:p.string.isRequired,body:p.string.isRequired,contentType:p.string.isRequired,createdAt:p.number.isRequired,position:p.oneOf(["left","right"])};const kt=(s,t,a)=>{const n=t.find(c=>c.id===s.authorId);return n?s.authorId===a.id?{name:"Me",avatar:a.avatar,isUser:!0}:{avatar:n.avatar,name:n.name,isUser:!1}:{name:"Unknown",avatar:"",isUser:!1}},Ie=s=>{const{messages:t=[],participants:a=[],...n}=s,c=N();return e.jsx(A,{spacing:2,sx:{p:3},...n,children:t.map(r=>{const i=kt(r,a,c);return e.jsx(Se,{authorAvatar:i.avatar,authorName:i.name,body:r.body,contentType:r.contentType,createdAt:r.createdAt,position:i.isUser?"right":"left"},r.id)})})};Ie.propTypes={messages:p.array,participants:p.array};var At=function(t){return e.jsxs("svg",ie({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none"},t,{children:[e.jsx("path",{fill:"#fff",fillOpacity:.01,d:"M16.5261 8.4a5.4 5.4 0 1 0-10.8 0c0 2.7812-.7016 4.6854-1.4853 5.9449-.661 1.0624-.9916 1.5936-.9795 1.7418.0134.1641.0482.2266.1804.3247.1194.0886.6578.0886 1.7344.0886h11.9c1.0767 0 1.615 0 1.7344-.0886.1322-.0981.167-.1606.1804-.3247.0121-.1482-.3184-.6794-.9795-1.7418-.7837-1.2595-1.4853-3.1637-1.4853-5.9449Z"}),e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.7449 20.1c.6346.5601 1.4682.9 2.3812.9.913 0 1.7466-.3399 2.3813-.9m3.0187-11.7a5.4 5.4 0 1 0-10.8 0c0 2.7812-.7016 4.6854-1.4853 5.9449-.661 1.0624-.9916 1.5936-.9795 1.7418.0134.1641.0482.2266.1804.3247.1194.0886.6578.0886 1.7344.0886h11.9c1.0767 0 1.615 0 1.7344-.0886.1322-.0981.167-.1606.1804-.3247.0121-.1482-.3184-.6794-.9795-1.7418-.7837-1.2595-1.4853-3.1637-1.4853-5.9449Z"})]}))},St=function(t){return e.jsx("svg",ie({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none"},t,{children:e.jsx("path",{fill:"#fff",fillOpacity:.01,stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.3803 8.8534c.696 1.4496 1.6448 2.8082 2.8463 4.0098 1.2016 1.2016 2.5603 2.1504 4.0099 2.8464.1247.0598.187.0898.2659.1128.2804.0817.6246.023.862-.147.0669-.0479.124-.105.2383-.2193.3496-.3497.5244-.5245.7002-.6387a2 2 0 0 1 2.1804 0c.1758.1142.3506.289.7002.6387l.1948.1948c.5315.5315.7972.7972.9415 1.0826a1.9998 1.9998 0 0 1 0 1.8054c-.1443.2853-.41.5511-.9415 1.0825l-.1576.1576c-.5296.5297-.7944.7945-1.1545.9967-.3995.2244-1.02.3858-1.4782.3844-.4129-.0012-.6952-.0813-1.2596-.2415-3.0334-.861-5.8958-2.4854-8.2837-4.8734-2.388-2.388-4.0125-5.2504-4.8735-8.2838-.1602-.5644-.2403-.8466-.2415-1.2596-.0014-.4582.16-1.0787.3844-1.4782.2023-.36.467-.6248.9967-1.1545l.1576-.1576C5 3.1801 5.2656 2.9143 5.551 2.77a2 2 0 0 1 1.8054 0c.2853.1443.551.41 1.0825.9415l.1949.1949c.3496.3496.5244.5244.6387.7002a2 2 0 0 1 0 2.1803c-.1143.1758-.2891.3506-.6387.7002-.1143.1143-.1715.1715-.2193.2383-.17.2374-.2287.5817-.147.862.023.079.053.1413.1128.266Z"})}))},It=function(t){return e.jsxs("svg",ie({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none"},t,{children:[e.jsx("path",{fill:"#fff",fillOpacity:.01,d:"M12 21c4.9706 0 9-4.0294 9-9s-4.0294-9-9-9-9 4.0294-9 9 4.0294 9 9 9Z"}),e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"m5.637 5.637 12.726 12.726M21 12c0 4.9706-4.0294 9-9 9s-9-4.0294-9-9 4.0294-9 9-9 9 4.0294 9 9Z"})]}))};const Rt=(s,t)=>s.filter(a=>a.id!==t),Et=s=>s.map(t=>t.name).join(", "),Pt=s=>s.length===1&&s[0].lastActivity?be(s[0].lastActivity,{addSuffix:!0}):null,Re=s=>{const{participants:t=[],...a}=s,n=N(),c=He(),r=Rt(t,n.id),i=Et(r),o=Pt(r);return e.jsxs(e.Fragment,{children:[e.jsxs(A,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:2,sx:{flexShrink:0,minHeight:64,px:2,py:1},...a,children:[e.jsxs(A,{alignItems:"center",direction:"row",spacing:2,children:[e.jsx(je,{max:2,sx:{...r.length>1&&{"& .MuiAvatar-root":{height:30,width:30,"&:nth-of-type(2)":{mt:"10px"}}}},children:r.map(l=>e.jsx(W,{src:l.avatar||void 0},l.id))}),e.jsxs("div",{children:[e.jsx(T,{variant:"subtitle2",children:i}),o&&e.jsxs(T,{color:"text.secondary",variant:"caption",children:["Last active ",o]})]})]}),e.jsxs(A,{alignItems:"center",direction:"row",spacing:1,children:[e.jsx(R,{children:e.jsx(C,{children:e.jsx(St,{})})}),e.jsx(R,{children:e.jsx(C,{children:e.jsx(ve,{})})}),e.jsx(Y,{title:"More options",children:e.jsx(R,{onClick:c.handleOpen,ref:c.anchorRef,children:e.jsx(C,{children:e.jsx(tt,{})})})})]})]}),e.jsxs(Ke,{anchorEl:c.anchorRef.current,keepMounted:!0,onClose:c.handleClose,open:c.open,children:[e.jsxs(z,{children:[e.jsx(Q,{children:e.jsx(C,{children:e.jsx(It,{})})}),e.jsx(G,{primary:"Block"})]}),e.jsxs(z,{children:[e.jsx(Q,{children:e.jsx(C,{children:e.jsx(st,{})})}),e.jsx(G,{primary:"Delete"})]}),e.jsxs(z,{children:[e.jsx(Q,{children:e.jsx(C,{children:e.jsx(et,{})})}),e.jsx(G,{primary:"Archive"})]}),e.jsxs(z,{children:[e.jsx(Q,{children:e.jsx(C,{children:e.jsx(At,{})})}),e.jsx(G,{primary:"Mute"})]})]})]})};Re.propTypes={participants:p.array};const Mt=s=>{const t=V(),[a,n]=d.useState([]),c=d.useCallback(async()=>{try{const r=await E.getParticipants({threadKey:s});n(r)}catch(r){console.error(r),t.push(D.dashboard.chat)}},[t,s]);return d.useEffect(()=>{c()},[s]),a},Lt=s=>{const t=V(),a=_(),n=ne(r=>{const{threads:i,currentThreadId:o}=r.chat;return i.byId[o]}),c=d.useCallback(async()=>{let r;try{r=await a(I.getThread({threadKey:s}))}catch(i){console.error(i),t.push(D.dashboard.chat);return}a(I.setCurrentThread({threadId:r})),r&&a(I.markThreadAsSeen({threadId:r}))},[t,a,s]);return d.useEffect(()=>{c()},[s]),n},Dt=s=>{const t=d.useRef(null),a=d.useCallback(()=>{if(!s||!t.current)return;const n=t.current,c=n.getScrollElement();c&&(c.scrollTop=n.el.scrollHeight)},[s]);return d.useEffect(()=>{a()},[s]),{messagesRef:t}},Ee=s=>{const{threadKey:t,...a}=s,n=_(),c=N(),r=Lt(t),i=Mt(t),{messagesRef:o}=Dt(r),l=d.useCallback(async h=>{if(r){try{await n(I.addMessage({threadId:r.id,body:h}))}catch(u){console.error(u)}return}const g=i.filter(u=>u.id!==c.id).map(u=>u.id);let x;try{x=await n(I.addMessage({recipientIds:g,body:h}))}catch(u){console.error(u);return}try{await n(I.getThread({threadKey:x}))}catch(u){console.error(u);return}n(I.setCurrentThread({threadId:x}))},[n,i,r,c]);return e.jsxs(A,{sx:{flexGrow:1,overflow:"hidden"},...a,children:[e.jsx(Re,{participants:i}),e.jsx(U,{}),e.jsx(f,{sx:{flexGrow:1,overflow:"hidden"},children:e.jsx(re,{ref:o,sx:{maxHeight:"100%"},children:e.jsx(Ie,{messages:(r==null?void 0:r.messages)||[],participants:(r==null?void 0:r.participants)||[]})})}),e.jsx(U,{}),e.jsx(oe,{onSend:l})]})};Ee.propTypes={threadKey:p.string.isRequired};const Wt=()=>{const s=_(),t=d.useCallback(()=>{s(I.getThreads())},[s]);d.useEffect(()=>{t()},[])},Ft=()=>{const s=ye(),t=me(l=>l.breakpoints.up("md")),[a,n]=d.useState(t),c=d.useCallback(()=>{n(!!t)},[t]);d.useEffect(()=>{c()},[t]);const r=d.useCallback(()=>{t||n(!1)},[t]);d.useEffect(()=>{r()},[s]);const i=d.useCallback(()=>{n(l=>!l)},[]),o=d.useCallback(()=>{n(!1)},[]);return{handleToggle:i,handleClose:o,open:a}},is=()=>{const s=d.useRef(null),t=ye(),a=t.get("compose")==="true",n=t.get("threadKey")||void 0,c=Ft();ze(),Wt();const r=n?"thread":a?"compose":"blank";return e.jsxs(e.Fragment,{children:[e.jsx($e,{title:"Dashboard: Chat"}),e.jsx(U,{}),e.jsx(f,{component:"main",sx:{backgroundColor:"background.paper",flex:"1 1 auto",overflow:"hidden",position:"relative"},children:e.jsxs(f,{ref:s,sx:{bottom:0,display:"flex",left:0,position:"absolute",right:0,top:0},children:[e.jsx(Ae,{container:s.current,onClose:c.handleClose,open:c.open}),e.jsxs(ft,{open:c.open,children:[e.jsx(f,{sx:{p:2},children:e.jsx(R,{onClick:c.handleToggle,children:e.jsx(C,{children:e.jsx(Xe,{})})})}),e.jsx(U,{}),r==="thread"&&e.jsx(Ee,{threadKey:n}),r==="compose"&&e.jsx(pt,{}),r==="blank"&&e.jsx(at,{})]})]})})]})};export{is as default};
