import{P as o,u as G,E as _,j as e,c as h,T as m,a as f,d as A,a6 as Z,e as P,F as B,aO as F,S as q,M as I,r as d,Y as ee,a9 as ae,B as w,aa as R,h as z,l as ne,s as te,D as T,O as se,a5 as re,z as le,aq as oe,t as W,aP as E}from"./index-345a54fd.js";import{P as ie}from"./Plus-2c210ce3.js";import{S as ce}from"./seo-ea61f518.js";import{u as de}from"./use-page-view-43790c32.js";import{n as H}from"./numeral-7a89f655.js";import{E as ue}from"./Edit02-74dfa7a1.js";import{P as pe,a as b}from"./property-list-item-b239a2fb.js";import{S as U}from"./severity-pill-ad7a45ee.js";import{a as M}from"./data-ada0f0b8.js";import{T as $,a as L,b as g,c as V}from"./TableRow-8f2ec0b0.js";import{T as me}from"./TableHead-fa724656.js";import{c as he,a as O,u as xe}from"./formik.esm-df7192cb.js";import{a as je}from"./axios-instance-67182a36.js";import{C as be}from"./Card-15cadf45.js";import{C as ve}from"./CardHeader-06bf02fa.js";import{C as ye}from"./CardContent-ad559ce1.js";import{u as ge}from"./use-update-effect-d9f6f2b5.js";import{T as fe,a as Ce}from"./Tabs-f33c10ba.js";import{T as Pe}from"./TablePagination-096da408.js";import{l as we}from"./index-7ffecf5e.js";import"./ListItem-1cf25ad9.js";import"./index-96e7fc06.js";import"./index-ecc76830.js";import"./index-71286f46.js";import"./index-078e6bc2.js";import"./KeyboardArrowRight-7b5ddf7b.js";import"./deep-copy-ee95be26.js";import"./apply-pagination-03aa54c3.js";import"./apply-sort-95de74ec.js";const ke={cancelled:"warning",complete:"success",pending:"info",rejected:"error"},N=s=>{const{onApprove:a,onEdit:c,onReject:l,onPayback:u,onReview:n,loan:t}=s,r=G(p=>p.breakpoints.up("lg"))?"horizontal":"vertical",v=_(new Date(t.application_time),"dd/MM/yyyy"),x=_(new Date(t.application_time),"HH:mm:ss:mm"),y=ke[t.loan_status],j=H(t.amount_payable).format("0,0.00");return M(1)[0],e.jsxs(h,{spacing:6,children:[e.jsxs(h,{spacing:3,children:[e.jsxs(h,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:3,children:[e.jsx(m,{variant:"h6",children:"Details"}),e.jsx(f,{color:"inherit",onClick:c,size:"small",startIcon:e.jsx(A,{children:e.jsx(ue,{})}),children:"Edit"})]}),e.jsxs(pe,{children:[e.jsx(b,{align:r,disableGutters:!0,divider:!0,label:"ID",value:t.id}),e.jsx(b,{align:r,disableGutters:!0,divider:!0,label:"Customer",children:e.jsx(m,{color:"text.secondary",variant:"body2",children:t.borrowed_by})}),e.jsx(b,{align:r,disableGutters:!0,divider:!0,label:"Reviewed by",children:e.jsx(m,{color:"text.secondary",variant:"body2",children:t.reviewed_by})}),e.jsx(b,{align:r,disableGutters:!0,divider:!0,label:"Percent Interest",children:e.jsx(m,{color:"text.secondary",variant:"body2",children:t.percent_interest})}),e.jsx(b,{align:r,disableGutters:!0,divider:!0,label:"Comments",children:e.jsx(m,{color:"text.secondary",variant:"body2",children:t.comments})}),e.jsx(b,{align:r,disableGutters:!0,divider:!0,label:"Payment interval",children:e.jsx(m,{color:"text.secondary",variant:"body2",children:t.payment_intervals})}),e.jsx(b,{align:r,disableGutters:!0,divider:!0,label:"Cumulative payments",children:e.jsx(m,{color:"text.secondary",variant:"body2",children:t.cumulative_payments})}),e.jsx(b,{align:r,disableGutters:!0,divider:!0,label:"Application time",children:e.jsx(m,{color:"text.secondary",variant:"body2",children:x})}),e.jsx(b,{align:r,disableGutters:!0,divider:!0,label:"Date",value:v}),e.jsx(b,{align:r,disableGutters:!0,divider:!0,label:"Principal",value:t.principal}),e.jsx(b,{align:r,disableGutters:!0,divider:!0,label:"Total Amount",value:j}),e.jsx(b,{align:r,disableGutters:!0,divider:!0,label:"Status",children:e.jsx(U,{color:y,children:t.loan_status})})]}),e.jsxs(h,{alignItems:"center",direction:"row",flexWrap:"wrap",justifyContent:"space-between",spacing:2,children:[e.jsx(f,{onClick:a,size:"small",variant:"contained",children:"Review"}),e.jsx(f,{color:"success",onClick:u,size:"small",variant:"outlined",children:"Payback"}),e.jsx(f,{color:"info",onClick:a,size:"small",variant:"contained",children:"Approve"}),e.jsx(f,{color:"error",onClick:l,size:"small",variant:"outlined",children:"Reject"})]})]}),e.jsxs(h,{spacing:3,children:[e.jsx(m,{variant:"h6",children:"Loan items"}),e.jsx(Z,{children:e.jsxs($,{sx:{minWidth:400},children:[e.jsx(me,{children:e.jsxs(L,{children:[e.jsx(g,{children:"Disbursed by"}),e.jsx(g,{children:"Percent Interest"}),e.jsx(g,{children:"Intervals"}),e.jsx(g,{children:"Amount"})]})}),e.jsx(V,{children:e.jsxs(L,{children:[e.jsx(g,{children:t.disbursed_by.slice(0,6)+". . ."}),e.jsx(g,{children:t.percent_interest}),e.jsx(g,{children:t.payment_intervals}),e.jsx(g,{children:j})]})})]})})]})]})};N.propTypes={onApprove:o.func,onEdit:o.func,onReject:o.func,loan:o.object};const Se=[{label:"Cancelled",value:"cancelled"},{label:"Complete",value:"complete"},{label:"Pending",value:"pending"},{label:"Rejected",value:"rejected"}],Q=s=>{const{onCancel:a,onSave:c,loan:l}=s,u=_(new Date(l.application_time),"dd/MM/yyyy HH:mm"),n=M(1)[0],t=`${n.first_name} ${n.surname}`;return e.jsx(h,{spacing:6,children:e.jsxs(h,{spacing:3,children:[e.jsx(m,{variant:"h6",children:"Details"}),e.jsxs(h,{spacing:3,children:[e.jsx(P,{disabled:!0,fullWidth:!0,label:"ID",name:"id",value:l.id}),e.jsx(P,{disabled:!0,fullWidth:!0,label:"Number",name:"number",value:l.id}),e.jsx(P,{disabled:!0,fullWidth:!0,label:"Customer name",name:"customer_name",value:t}),e.jsx(P,{disabled:!0,fullWidth:!0,label:"Date",name:"date",value:u}),e.jsx(P,{fullWidth:!0,label:"Address",name:"address",value:n.address}),e.jsx(P,{fullWidth:!0,label:"Total Amount",name:"amount",value:l.principal}),e.jsx(P,{fullWidth:!0,label:"Amount Payable",name:"amount",value:l.amount_payable}),e.jsxs(B,{sx:{m:1,minWidth:120},children:[e.jsx(F,{id:"payment_interval",children:"Status"}),e.jsx(q,{labelId:"payment_interval",name:"payment_interval",id:"payment_interval",value:l.loan_status,label:"Payment Interval",children:Se.map(i=>e.jsx(I,{value:i.value,children:i.label.toUpperCase()},i.value))})]})]}),e.jsxs(h,{alignItems:"center",direction:"row",flexWrap:"wrap",spacing:2,children:[e.jsx(f,{color:"primary",onClick:c,size:"small",variant:"contained",children:"Save changes"}),e.jsx(f,{color:"inherit",onClick:a,size:"small",children:"Cancel"})]})]})})};Q.propTypes={onCancel:o.func,onSave:o.func,order:o.object};const X=s=>{const{container:a,onClose:c,onPayback:l,open:u,loan:n}=s,[t,i]=d.useState(!1),r=G(j=>j.breakpoints.up("lg")),v=d.useCallback(()=>{i(!0)},[]),x=d.useCallback(()=>{i(!1)},[]);let y=null;return n&&(y=e.jsxs("div",{children:[e.jsxs(h,{alignItems:"center",direction:"row",justifyContent:"space-between",sx:{px:3,py:2},children:[e.jsx(m,{color:"inherit",variant:"h6",children:n.id}),e.jsx(ee,{color:"inherit",onClick:c,children:e.jsx(A,{children:e.jsx(ae,{})})})]}),e.jsx(w,{sx:{px:3,py:4},children:t?e.jsx(Q,{onCancel:x,onSave:x,loan:n}):e.jsx(N,{onApprove:c,onPayback:l,onEdit:v,onReject:c,loan:n})})]})),r?e.jsx(R,{anchor:"right",open:u,PaperProps:{sx:{position:"relative",width:500}},SlideProps:{container:a},variant:"persistent",children:y}):e.jsx(R,{anchor:"left",hideBackdrop:!0,ModalProps:{container:a,sx:{pointerEvents:"none",position:"absolute"}},onClose:c,open:u,PaperProps:{sx:{maxWidth:"100%",width:400,pointerEvents:"auto",position:"absolute"}},SlideProps:{container:a},variant:"temporary",children:y})};X.propTypes={container:o.any,onClose:o.func,open:o.bool,loan:o.object};const _e={principal:55e3,payment_interval:"weekly",submit:null},Te=he({principal:O().max(255).required("Principal is required"),payment_interval:O().oneOf(["weekly","monthly"]).required("Payment interval is required")}),Y=s=>{const{onCancel:a,onApply:c,customer:l}=s,u=z(),n=xe({initialValues:_e,validationSchema:Te,onSubmit:async(t,i)=>{try{const r=window.sessionStorage.getItem("accessToken"),x=await je(r).post("/loans/apply",{principal:t.principal,pay_intervals:t.payment_interval});console.log(x)}catch(r){console.error(r),u()&&(i.setStatus({success:!1}),i.setErrors({submit:r.message}),i.setSubmitting(!1))}}});return e.jsx(h,{sx:{justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsxs(be,{elevation:16,sx:{width:"40%"},children:[e.jsx(ve,{sx:{pb:0},title:"Loan Application"}),e.jsx(ye,{children:e.jsxs("form",{noValidate:!0,onSubmit:n.handleSubmit,children:[e.jsxs(h,{spacing:2,children:[e.jsx(P,{autoFocus:!0,error:!!(n.touched.principal&&n.errors.principal),fullWidth:!0,helperText:n.touched.principal&&n.errors.principal,label:"Principal",name:"principal",onBlur:n.handleBlur,onChange:n.handleChange,type:"text",value:n.values.principal}),e.jsxs(B,{sx:{m:1,minWidth:120},children:[e.jsx(F,{id:"payment_interval",children:"Payment Interval"}),e.jsxs(q,{labelId:"payment_interval",name:"payment_interval",id:"payment_interval",value:n.values.payment_interval,label:"Payment Interval",onChange:n.handleChange,children:[e.jsx(I,{value:"weekly",children:"Weekly"}),e.jsx(I,{value:"monthy",children:"Monthly"})]})]})]}),n.errors.submit&&e.jsx(ne,{error:!0,sx:{mt:3},children:n.errors.submit}),e.jsxs(h,{alignItems:"center",direction:"row",spacing:2,marginTop:3,justifyContent:"space-between",children:[e.jsx(f,{color:"primary",onClick:c,size:"small",fullWidth:!0,variant:"contained",type:"submit",children:"Apply"}),e.jsx(f,{color:"error",onClick:a,size:"small",variant:"outlined",fullWidth:!0,children:"Cancel"})]})]})})]})})};Y.propTypes={onCancel:o.func.isRequired,onApply:o.func.isRequired,customer:o.any.isRequired};o.any,o.func,o.bool,o.object;const Ae=te("div",{shouldForwardProp:s=>s!=="open"})(({theme:s,open:a})=>({flexGrow:1,overflow:"auto",zIndex:1,[s.breakpoints.up("lg")]:{marginRight:-500},transition:s.transitions.create("margin",{easing:s.transitions.easing.sharp,duration:s.transitions.duration.leavingScreen}),...a&&{[s.breakpoints.up("lg")]:{marginRight:0},transition:s.transitions.create("margin",{easing:s.transitions.easing.easeOut,duration:s.transitions.duration.enteringScreen})}})),Ie=[{label:"All",value:"all"},{label:"Canceled",value:"cancelled"},{label:"Completed",value:"complete"},{label:"Pending",value:"pending"},{label:"Rejected",value:"rejected"}],Le=[{label:"Newest",value:"desc"},{label:"Oldest",value:"asc"}],J=s=>{const{onFiltersChange:a,onSortChange:c,sortDir:l="asc"}=s,u=d.useRef(null),[n,t]=d.useState("all"),[i,r]=d.useState({query:void 0,status:void 0}),v=d.useCallback(()=>{a==null||a(i)},[i,a]);ge(()=>{v()},[i,v]);const x=d.useCallback((p,C)=>{t(C);const k=C==="all"?void 0:C;r(S=>({...S,status:k}))},[]),y=d.useCallback(p=>{var k;p.preventDefault();const C=((k=u.current)==null?void 0:k.value)||"";r(S=>({...S,query:C}))},[]),j=d.useCallback(p=>{const C=p.target.value;c==null||c(C)},[c]);return e.jsxs("div",{children:[e.jsx(fe,{indicatorColor:"primary",onChange:x,scrollButtons:"auto",sx:{px:3},textColor:"primary",value:n,variant:"scrollable",children:Ie.map(p=>e.jsx(Ce,{label:p.label,value:p.value},p.value))}),e.jsx(T,{}),e.jsxs(h,{alignItems:"center",direction:"row",flexWrap:"wrap",gap:3,sx:{p:3},children:[e.jsx(w,{component:"form",onSubmit:y,sx:{flexGrow:1},children:e.jsx(se,{defaultValue:"",fullWidth:!0,inputProps:{ref:u},name:"orderNumber",placeholder:"Search by loan number",startAdornment:e.jsx(re,{position:"start",children:e.jsx(A,{children:e.jsx(le,{})})})})}),e.jsx(P,{label:"Sort By",name:"sort",onChange:j,select:!0,SelectProps:{native:!0},value:l,children:Le.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]})]})};J.propTypes={onFiltersChange:o.func,onSortChange:o.func,sortBy:o.string,sortDir:o.oneOf(["asc","desc"])};const Me={complete:"success",pending:"info",cancelled:"warning",rejected:"error"},K=s=>{const{count:a=0,items:c=[],onPageChange:l=()=>{},onRowsPerPageChange:u,onSelect:n,page:t=0,rowsPerPage:i=0}=s;return e.jsxs("div",{children:[e.jsx($,{children:e.jsx(V,{children:c.map(r=>{const v=_(new Date(r.application_time),"MMMM").slice(0,3),x=_(new Date(r.application_time),"dd"),y=H(r.amount_payable).format("$0,0.00"),j=Me[r.loan_status]||"warning";return e.jsxs(L,{hover:!0,onClick:()=>n==null?void 0:n(r.id),sx:{cursor:"pointer"},children:[e.jsxs(g,{sx:{alignItems:"center",display:"flex"},children:[e.jsxs(w,{sx:{backgroundColor:p=>p.palette.mode==="dark"?"neutral.800":"neutral.200",borderRadius:2,maxWidth:"fit-content",ml:3,p:1},children:[e.jsx(m,{align:"center",variant:"subtitle2",children:v}),e.jsx(m,{align:"center",variant:"h6",children:x})]}),e.jsxs(w,{sx:{ml:2},children:[e.jsx(m,{variant:"subtitle2",children:r.id.slice(0,15)+"..."}),e.jsxs(m,{color:"text.secondary",variant:"body2",children:["Total of ",y]})]})]}),e.jsx(g,{align:"right",children:e.jsx(U,{color:j,children:r.loan_status})})]},r.id)})})}),e.jsx(Pe,{component:"div",count:a,onPageChange:l,onRowsPerPageChange:u,page:t,rowsPerPage:i,rowsPerPageOptions:[5,10,25]})]})};K.propTypes={count:o.number,items:o.array,onPageChange:o.func,onRowsPerPageChange:o.func,onSelect:o.func,page:o.number,rowsPerPage:o.number};const De=()=>{const[s,a]=d.useState({filters:{query:void 0,status:void 0},page:0,rowsPerPage:5,sortBy:"createdAt",sortDir:"desc"}),c=d.useCallback(t=>{a(i=>({...i,filters:t}))},[]),l=d.useCallback(t=>{a(i=>({...i,sortDir:t}))},[]),u=d.useCallback((t,i)=>{a(r=>({...r,page:i}))},[]),n=d.useCallback(t=>{a(i=>({...i,rowsPerPage:parseInt(t.target.value,10)}))},[]);return{handleFiltersChange:c,handleSortChange:l,handlePageChange:u,handleRowsPerPageChange:n,state:s}},Re=s=>{const a=z(),[c,l]=d.useState({loans:[],loansCount:0}),u=d.useCallback(async()=>{try{const n=await we.getLoans(s);a()&&l({loans:n.data,loansCount:n.count})}catch(n){console.error(n)}},[s,a]);return d.useEffect(()=>{u()},[s]),{...c}},We=(s,a)=>d.useMemo(()=>{if(a)return s.find(c=>c.id===a)},[s,a]),ua=()=>{const s=d.useRef(null),a=De(),c=Re(a.state),l=oe(),u=We(c.loans,l.data),[n,t]=W.useState(!1),[i,r]=W.useState(!1),v=()=>t(!0),x=M(1)[0];de();const y=d.useCallback(()=>{},[]),j=d.useCallback(()=>t(!1),[]),p=d.useCallback(()=>console.log("Paying back..."),[]),C=d.useCallback(D=>{if(l.open&&l.data===D){l.handleClose();return}l.handleOpen(D)},[l]),k=n?e.jsx(E,{open:n,onClose:j,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsx(Y,{onCancel:j,onApply:y,customer:x})}):null,S=i?e.jsx(E,{open:i,onClose:j,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsx(e.Fragment,{})}):null;return e.jsxs(e.Fragment,{children:[e.jsx(ce,{title:"Dashboard: Loan List"}),e.jsx(T,{}),e.jsx(w,{component:"main",ref:s,sx:{display:"flex",flex:"1 1 auto",overflow:"hidden",position:"relative"},children:e.jsxs(w,{ref:s,sx:{bottom:0,display:"flex",left:0,position:"absolute",right:0,top:0},children:[e.jsxs(Ae,{open:l.open,children:[e.jsx(w,{sx:{p:3},children:e.jsxs(h,{alignItems:"flex-start",direction:"row",justifyContent:"space-between",spacing:4,children:[e.jsx("div",{children:e.jsx(m,{variant:"h4",children:"Loans"})}),e.jsx("div",{children:e.jsx(f,{startIcon:e.jsx(A,{children:e.jsx(ie,{})}),onClick:v,variant:"contained",children:"Apply for Loan"})})]})}),e.jsx(T,{}),e.jsx(J,{onFiltersChange:a.handleFiltersChange,onSortChange:a.handleSortChange,sortBy:a.state.sortBy,sortDir:a.state.sortDir}),e.jsx(T,{}),e.jsx(K,{count:c.loansCount,items:c.loans,onPageChange:a.handlePageChange,onRowsPerPageChange:a.handleRowsPerPageChange,onSelect:C,page:a.state.page,rowsPerPage:a.state.rowsPerPage})]}),e.jsx(X,{container:s.current,onClose:l.handleClose,onPayback:p,open:l.open,loan:u}),k,S]})})]})};export{ua as default};
